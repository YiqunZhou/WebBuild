<!doctype html>
<html lang="en">
  <head>
    <title>Admin Panel - Leilei Xia Portfolio</title>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”§</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Admin panel for managing portfolio projects" />

    <!-- Open Props -->
    <link rel="stylesheet" href="https://unpkg.com/open-props"/>
    <link rel="stylesheet" href="https://unpkg.com/open-props/normalize.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/open-props/buttons.min.css"/>

    <!-- EasyMDE Markdown Editor -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: var(--gray-1);
        color:black;
      }

      :where(textarea,select,input:not([type=button],[type=submit],[type=reset])){
        background-color:white;
      }
      
      
      .header {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--gray-3);
      }

      .header h1 {
        margin: 0 0 0.5rem 0;
        font-size: 2rem;
      }

      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: var(--blue-7);
        color: rgb(38, 27, 27);
        padding: 8px;
        text-decoration: none;
        z-index: 100;
      }

      .skip-link:focus {
        top: 0;
      }

      .tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        border-bottom: 2px solid var(--gray-3);
      }

      .tab-button {
        padding: 1rem 1.5rem;
        background: transparent;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.2s;
      }

      .tab-button:hover,
      .tab-button:focus {
        background: var(--gray-2);
        outline: 2px solid var(--blue-7);
        outline-offset: -2px;
      }

      .tab-button[aria-selected="true"] {
        border-bottom-color: var(--blue-7);
        color: var(--blue-7);
        font-weight: 700;
      }

      .tab-panel {
        display: none;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      .tab-panel[aria-hidden="false"] {
        display: block;
      }

      .form-section {
        margin-bottom: 2rem;
      }

      .form-section h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: var(--gray-9);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--gray-8);
      }

      .required::after {
        content: " *";
        color: var(--red-7);
      }

      input[type="text"],
      input[type="url"],
      input[type="number"],
      textarea,
      select {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid var(--gray-4);
        border-radius: 4px;
        font-size: 1rem;
        font-family: inherit;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: var(--blue-7);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      textarea {
        min-height: 100px;
        resize: vertical;
      }

      .help-text {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: var(--gray-6);
      }

      .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      button[type="submit"],
      .btn-primary {
        padding: 0.75rem 1.5rem;
        background: var(--blue-7);
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      button[type="submit"]:hover,
      button[type="submit"]:focus,
      .btn-primary:hover,
      .btn-primary:focus {
        background: var(--blue-8);
        outline: 2px solid var(--blue-9);
        outline-offset: 2px;
      }

      .btn-secondary {
        padding: 0.75rem 1.5rem;
        background: var(--gray-3);
        color: var(--gray-9);
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .btn-secondary:hover,
      .btn-secondary:focus {
        background: var(--gray-4);
        outline: 2px solid var(--gray-7);
        outline-offset: 2px;
      }

      .btn-danger {
        padding: 0.5rem 1rem;
        background: var(--red-7);
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
      }

      .btn-danger:hover,
      .btn-danger:focus {
        background: var(--red-8);
        outline: 2px solid var(--red-9);
        outline-offset: 2px;
      }

      .alert {
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 4px;
        border-left: 4px solid;
      }

      .alert-success {
        background: var(--green-1);
        border-left-color: var(--green-7);
        color: var(--green-9);
      }

      .alert-error {
        background: var(--red-1);
        border-left-color: var(--red-7);
        color: var(--red-9);
      }

      .alert-info {
        background: var(--blue-1);
        border-left-color: var(--blue-7);
        color: var(--blue-9);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      .projects-list {
        margin-top: 1rem;
      }

      .project-card {
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid var(--gray-3);
        border-radius: 4px;
        background: white;
      }

      .project-card h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.25rem;
      }

      .project-card p {
        margin: 0.25rem 0;
        color: var(--gray-7);
      }

      .project-actions {
        margin-top: 1rem;
        display: flex;
        gap: 0.5rem;
      }

      .loading {
        text-align: center;
        padding: 2rem;
        color: var(--gray-6);
      }

      .tag-input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .tag-checkbox {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem;
        border: 2px solid var(--gray-3);
        border-radius: 4px;
        cursor: pointer;
      }

      .tag-checkbox input[type="checkbox"] {
        width: auto;
        margin: 0;
      }

      .tag-checkbox:has(input:checked) {
        background: var(--blue-1);
        border-color: var(--blue-7);
      }

      .tag-checkbox:focus-within {
        outline: 2px solid var(--blue-7);
        outline-offset: 2px;
      }

      /* Modal styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }

      .modal-overlay[aria-hidden="false"] {
        display: flex;
      }

      .modal {
        background: white;
        border-radius: 8px;
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        padding: 1.5rem;
        border-bottom: 2px solid var(--gray-3);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
      }

      .modal-close {
        padding: 0.5rem;
        background: transparent;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray-7);
        line-height: 1;
      }

      .modal-close:hover,
      .modal-close:focus {
        color: var(--gray-9);
        outline: 2px solid var(--blue-7);
        outline-offset: 2px;
        border-radius: 4px;
      }

      .modal-body {
        padding: 1.5rem;
      }

      .modal-footer {
        padding: 1.5rem;
        border-top: 2px solid var(--gray-3);
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
      }

      /* Markdown Editor Styles */
      .EasyMDEContainer {
        margin-top: 0.5rem;
      }

      .EasyMDEContainer .CodeMirror {
        border: 2px solid var(--gray-4);
        border-radius: 4px;
        font-size: 1rem;
        min-height: 150px;
      }

      .EasyMDEContainer .CodeMirror:focus-within {
        border-color: var(--blue-7);
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .EasyMDEContainer .editor-toolbar {
        border: 2px solid var(--gray-4);
        border-bottom: none;
        border-radius: 4px 4px 0 0;
        background: var(--gray-1);
      }

      .EasyMDEContainer .editor-toolbar button {
        color: var(--gray-8);
      }

      .EasyMDEContainer .editor-toolbar button:hover,
      .EasyMDEContainer .editor-toolbar button.active {
        background: var(--gray-3);
        border-color: var(--gray-5);
      }

      .EasyMDEContainer .editor-toolbar button:focus {
        outline: 2px solid var(--blue-7);
        outline-offset: 2px;
      }

      .editor-preview {
        background: white;
        padding: 1rem;
      }

      .markdown-help {
        margin-top: 0.5rem;
        padding: 0.75rem;
        background: var(--blue-1);
        border-left: 4px solid var(--blue-7);
        border-radius: 4px;
        font-size: 0.875rem;
      }

      .markdown-help summary {
        cursor: pointer;
        font-weight: 600;
        color: var(--blue-9);
      }

      .markdown-help ul {
        margin: 0.5rem 0 0 1rem;
        padding: 0;
      }

      .markdown-help li {
        margin: 0.25rem 0;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header class="header">
      <h1>Portfolio Admin Panel</h1>
      <p>Manage your Notion portfolio database with screen reader accessibility</p>
    </header>

    <div id="alert-container" role="alert" aria-live="polite" aria-atomic="true"></div>

    <main id="main-content">
      <div role="tablist" aria-label="Admin sections" class="tabs">
        <button
          role="tab"
          aria-selected="true"
          aria-controls="add-project-panel"
          id="add-project-tab"
          class="tab-button"
          tabindex="0"
        >
          Add Project
        </button>
        <button
          role="tab"
          aria-selected="false"
          aria-controls="manage-projects-panel"
          id="manage-projects-tab"
          class="tab-button"
          tabindex="-1"
        >
          Manage Projects
        </button>
      </div>

      <!-- Add Project Tab -->
      <div
        role="tabpanel"
        id="add-project-panel"
        aria-labelledby="add-project-tab"
        aria-hidden="false"
        class="tab-panel"
      >
        <form id="add-project-form" aria-label="Add new project form">
          <div class="form-section">
            <h2>Project Information</h2>

            <div class="form-group">
              <label for="project-name" class="required">Project Name</label>
              <input
                type="text"
                id="project-name"
                name="name"
                required
                aria-required="true"
                aria-describedby="name-help"
              />
              <span id="name-help" class="help-text">
                The title of your project as it will appear on the website
              </span>
            </div>

            <div class="form-group">
              <label for="project-slug" class="required">URL Slug</label>
              <input
                type="text"
                id="project-slug"
                name="slug"
                required
                aria-required="true"
                aria-describedby="slug-help"
                pattern="[a-z0-9-]+"
              />
              <span id="slug-help" class="help-text">
                URL-friendly name (lowercase, hyphens only). Example: my-awesome-project
              </span>
            </div>

            <div class="form-group">
              <label for="project-description" class="required">Short Description</label>
              <textarea
                id="project-description"
                name="description"
                required
                aria-required="true"
                aria-describedby="description-help"
                rows="3"
              ></textarea>
              <span id="description-help" class="help-text">
                A brief summary (2-3 sentences) for the project card
              </span>
            </div>

            <div class="form-group">
              <label for="project-content">Page Content</label>
              <textarea
                id="project-content"
                name="content"
                aria-describedby="content-help"
              ></textarea>
              <span id="content-help" class="help-text">
                Full project content with Markdown formatting (bold, italic, links, images, headings, etc.)
              </span>
              <details class="markdown-help">
                <summary>Markdown Formatting Guide</summary>
                <ul>
                  <li><strong>**bold**</strong> for bold text</li>
                  <li><em>*italic*</em> for italic text</li>
                  <li>[link text](url) for links</li>
                  <li>![alt text](image-url) for images</li>
                  <li># Heading for headings (use ##, ###, #### for subheadings)</li>
                  <li>- item for bullet lists</li>
                  <li>1. item for numbered lists</li>
                  <li>> quote for blockquotes</li>
                  <li>`code` for inline code</li>
                  <li>```language for code blocks</li>
                  <li>--- for horizontal rules</li>
                </ul>
              </details>
            </div>

            <div class="form-group">
              <label for="project-type" class="required">Project Type</label>
              <select
                id="project-type"
                name="type"
                required
                aria-required="true"
                aria-describedby="type-help"
              >
                <option value="">Select a type</option>
                <option value="Project">Project</option>
                <option value="Film">Film</option>
                <option value="Animation">Animation</option>
                <option value="Workshop">Workshop</option>
                <option value="Installation">Installation</option>
                <option value="Publication">Publication</option>
              </select>
              <span id="type-help" class="help-text">
                The category of this work
              </span>
            </div>

            <div class="form-group">
              <label for="project-title-image" class="required">Title Image URL</label>
              <input
                type="url"
                id="project-title-image"
                name="titleImage"
                required
                aria-required="true"
                aria-describedby="title-image-help"
              />
              <span id="title-image-help" class="help-text">
                Full URL to the main image for this project
              </span>
            </div>

            <div class="form-group">
              <label for="project-ordering">Display Order</label>
              <input
                type="number"
                id="project-ordering"
                name="ordering"
                min="0"
                aria-describedby="ordering-help"
              />
              <span id="ordering-help" class="help-text">
                Lower numbers appear first. Leave empty to add at the end.
              </span>
            </div>

            <fieldset class="form-group">
              <legend>Tags</legend>
              <div id="tag-checkboxes" class="tag-input-container" role="group" aria-label="Select project tags">
                <!-- Tags will be loaded dynamically -->
              </div>
            </fieldset>
          </div>

          <div class="button-group">
            <button type="submit" class="btn-primary">
              Add Project
            </button>
            <button type="reset" class="btn-secondary">
              Clear Form
            </button>
          </div>
        </form>
      </div>

      <!-- Manage Projects Tab -->
      <div
        role="tabpanel"
        id="manage-projects-panel"
        aria-labelledby="manage-projects-tab"
        aria-hidden="true"
        class="tab-panel"
      >
        <div class="form-section">
          <h2>Existing Projects</h2>
          <button id="refresh-projects" class="btn-secondary" aria-label="Refresh projects list">
            Refresh List
          </button>
          <div id="projects-list" class="projects-list" aria-live="polite" aria-busy="false">
            <div class="loading">Loading projects...</div>
          </div>
        </div>
      </div>
    </main>

    <!-- Edit Project Modal -->
    <div
      id="edit-modal"
      class="modal-overlay"
      role="dialog"
      aria-modal="true"
      aria-labelledby="edit-modal-title"
      aria-hidden="true"
    >
      <div class="modal">
        <div class="modal-header">
          <h2 id="edit-modal-title">Edit Project</h2>
          <button
            type="button"
            class="modal-close"
            aria-label="Close dialog"
            onclick="closeEditModal()"
          >
            Ã—
          </button>
        </div>
        <div class="modal-body">
          <form id="edit-project-form" aria-label="Edit project form">
            <input type="hidden" id="edit-project-id" name="pageId" />

            <div class="form-group">
              <label for="edit-project-name" class="required">Project Name</label>
              <input
                type="text"
                id="edit-project-name"
                name="name"
                required
                aria-required="true"
              />
            </div>

            <div class="form-group">
              <label for="edit-project-slug" class="required">URL Slug</label>
              <input
                type="text"
                id="edit-project-slug"
                name="slug"
                required
                aria-required="true"
                pattern="[a-z0-9-]+"
              />
            </div>

            <div class="form-group">
              <label for="edit-project-description" class="required">Short Description</label>
              <textarea
                id="edit-project-description"
                name="description"
                required
                aria-required="true"
                rows="3"
              ></textarea>
              <span class="help-text">
                A brief summary (2-3 sentences) for the project card
              </span>
            </div>

            <div class="form-group">
              <label for="edit-project-content">Page Content</label>
              <textarea
                id="edit-project-content"
                name="content"
              ></textarea>
              <span class="help-text">
                Full project content with Markdown formatting
              </span>
              <details class="markdown-help">
                <summary>Markdown Formatting Guide</summary>
                <ul>
                  <li><strong>**bold**</strong> for bold text</li>
                  <li><em>*italic*</em> for italic text</li>
                  <li>[link text](url) for links</li>
                  <li>![alt text](image-url) for images</li>
                  <li># Heading for headings (use ##, ###, #### for subheadings)</li>
                  <li>- item for bullet lists</li>
                  <li>1. item for numbered lists</li>
                  <li>> quote for blockquotes</li>
                  <li>`code` for inline code</li>
                  <li>```language for code blocks</li>
                  <li>--- for horizontal rules</li>
                </ul>
              </details>
            </div>

            <div class="form-group">
              <label for="edit-project-type" class="required">Project Type</label>
              <select
                id="edit-project-type"
                name="type"
                required
                aria-required="true"
              >
                <option value="">Select a type</option>
                <option value="Project">Project</option>
                <option value="Film">Film</option>
                <option value="Animation">Animation</option>
                <option value="Workshop">Workshop</option>
                <option value="Installation">Installation</option>
                <option value="Publication">Publication</option>
              </select>
            </div>

            <div class="form-group">
              <label for="edit-project-title-image" class="required">Title Image URL</label>
              <input
                type="url"
                id="edit-project-title-image"
                name="titleImage"
                required
                aria-required="true"
              />
            </div>

            <div class="form-group">
              <label for="edit-project-ordering">Display Order</label>
              <input
                type="number"
                id="edit-project-ordering"
                name="ordering"
                min="0"
              />
            </div>

            <div class="form-group">
              <label for="edit-project-status">Status</label>
              <select id="edit-project-status" name="status">
                <option value="done">Done (Published)</option>
                <option value="in progress">In Progress</option>
                <option value="not started">Not Started</option>
              </select>
            </div>

            <fieldset class="form-group">
              <legend>Tags</legend>
              <div id="edit-tag-checkboxes" class="tag-input-container" role="group" aria-label="Select project tags">
                <!-- Tags will be loaded dynamically -->
              </div>
            </fieldset>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeEditModal()">
            Cancel
          </button>
          <button type="button" class="btn-primary" onclick="handleUpdateProject()">
            Update Project
          </button>
        </div>
      </div>
    </div>

    <script type="module" src="/src/admin.js"></script>
  </body>
</html>
